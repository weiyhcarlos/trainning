# mongodb集群


## 一.集群概念
### Replication 复制集
作用：

    1.为数据提供了冗余同时，也提高了数据的可用性
    2.提高读的性能
    3.异地容灾

原理机制：

    复制集成员
        1.复制集主节点--只有一个，且唯一接收写操作
        2.复制集从节点--主节点上同步数据（oplog）且可以接受读请求
        3.优先级为0的复制集成员--仅能为从节点而不可被推选为主节点。
        4.隐藏节点--对应用不可见。作为专用节点，如报表节点或是备份节点
        5.投票节点--仅参与投票，不包含数据集
    高可用
        1.复制集选举--主节点不可用时选举并推选出一个新的主节点
        2.故障切换时的回滚--故障切换后未应用到其他节点的写操作将会回滚




### sharding 分片
作用：

    应对高吞吐量与大数据量

原理机制：
    
    集群成员
        1.分片服务器--mongod或replica set,存储数据
        2.配置服务器--存储集群元信息
        3.路由服务器-- mongos 集群入口
    片键：
        1.范围片键--导致数据不均衡
        2.哈希片键--范围查询性能损失
    数据均衡：
        1.分裂：防止数据块过大的后台任务，数据块一分为二，不发生迁移
        2.均衡：将数据块从数据块数目最多的分片迁移到数据块最少的分片
    高可用：
        1.应用服务器或者 mongos 不可用--每个应用服务器都有独自的mongos,互相独立。mongos可随时重启，变为不可用时不会丢失数据
        2.一个分片中的一个 mongod 不可用--复制集实现高可用
        3.复制集中所有成员都不可用--该分片数据不可用，但其他分片数据仍然可用，应用程序只能获取部分结果
        4.一个或者两个配置服务器不可用--三台配置服务器使用两段提交保证mongod之间一致性，一个或两个不可用集群操作仍可进行，但不能进行数据块迁移和数据块分裂

## 二.集群信息
机器IP：

    123.58.165.132
分片：

    rs1
        172.17.0.5：27017 外网访问：<机器IP>:32788
        172.17.0.6：27017 外网访问：<机器IP>:32789
        172.17.0.7：27017 外网访问：<机器IP>:32790
    rs2
        172.17.0.8：27017 外网访问：<机器IP>:32791
        172.17.0.9：27017 外网访问：<机器IP>:32792
        172.17.0.10：27017 外网访问：<机器IP>:32793

配置服务器：

    172.17.0.11：27017 外网访问：<机器IP>:32794
    172.17.0.12：27017 外网访问：<机器IP>:32795
    172.17.0.13：27017 外网访问：<机器IP>:32796

mogos：

    172.17.0.14：27017 外网访问：<机器IP>:32797
